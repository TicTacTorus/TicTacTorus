@page "/game"

@using TicTacTorus.Source
@using System.Drawing
@using TicTacTorus.Source.Generator
@using TicTacTorus.Source.LobbySpecificContent


@{
    // if angemeldet 
    // else generiere Name/Player
    
    IPlayer i_am;

    var name = AnonymPlayerNameGenerator.GetString();
    var color = ColorGenerator.GetColor();
    var symbol = ByteGenerator.GetByte();
    i_am = new HumanPlayer("xyz", name, color, symbol);
    
    InitLobby();
}
<div class="my-5 lobbies-grid">
    <button class="btn-back" onclick="location.href ='/';">
        <svg class="bi bi-arrow-left" width="2em" height="2em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M5.854 4.646a.5.5 0 010 .708L3.207 8l2.647 2.646a.5.5 0 01-.708.708l-3-3a.5.5 0 010-.708l3-3a.5.5 0 01.708 0z" clip-rule="evenodd"/>
            <path fill-rule="evenodd" d="M2.5 8a.5.5 0 01.5-.5h10.5a.5.5 0 010 1H3a.5.5 0 01-.5-.5z" clip-rule="evenodd"/>
        </svg>
    </button>
    <h1 class="headers">@_lobby.Name</h1>
    <input name="show_title" type="text" style='display:none' id="show_title" size="64" class="w-100 align-bottom"/>
</div>
<div contenteditable="true" class="text-center my-3">
    <p>@_lobby.Description</p>
</div>
<div class="d-flex justify-content-center">
    
    <div class="row">
        <div class="col-sm-9 col-md-7 col-lg-4 mx-auto my-1">
            <!-- Players Box -->
            <div class="box box-lobby w-100">
                <div class="box-content">
                    <b><h3 class="text-center">Players (0/0)</h3></b>
                    <hr>
                    <div>
                        <table id="player_table_in_lobby">
                            @foreach (var elem in PlayerList())
                            {
                                <tr id="player_table_row">
                                <td><button onclick='MessageChatBox("@elem.ID got kicked")'>Kick</button></td>
                                <td>
                                @{
                                    var classText = "color:" + ColorTranslator.ToHtml(@elem.Color)+ ";" ;
                                    classText += "\nfont-size: large;" +
                                                 "\nfont-weight: bold;";
                                    classText += "\ntext-shadow: 1px 1px 0px black;";
                                    <div style="@classText">@elem.IngameName</div>
                                } 
                                </td>
                                <td>@elem.Symbol</td>
                                </tr>
                            }
                        </table>
                        
                        <!-- Content goes here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-9 col-md-7 col-lg-4 mx-auto my-1">
            <!-- Chat Box -->
            <div class="box box-lobby w-100">
                <div class="box-content">
                    <b><h3 class="text-center">Chat</h3></b>
                    <hr>
                    <div id="chatbox">
                        <!-- Content goes here -->
                    </div>
                    <input type="text" class="w-100 align-bottom"/>
                </div>
            </div>
            <div class="below-chat col">
                <h5 class="text-center">Share this link to invite others</h5>
                <!--<div style="border-style: solid; border-width: 1px; border-radius: 10px; background: #ffffff" class="text-center my-2">
                    http://www.brammens.com
                </div>-->
                <button id="link-copy" class="btn btn-primary-custom p-2" onclick="CopyText"> @InviteLink </button>
                <button class="btn btn-primary-custom p-2" onclick="location.href ='ingame';">
                    <svg class="bi bi-play-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 010 1.393z"/>
                    </svg>
                    Play
                </button>
            </div>
        </div>

        <div class="col-sm-9 col-md-7 col-lg-4 mx-auto my-1">
            <!-- Settings Box -->
            <div class="box box-lobby w-100">
                <div class="box-content">
                    <b><h3 class="text-center">Settings</h3></b>
                    <hr>
                    <div>
                        <!-- Content goes here -->
                        <table>
                            <tr>
                                <EditForm Model="@_lobby" OnValidSubmit="HandleDescriptionChange">
                                    <label>Description</label>
                                    <InputText id="host_description" type="text" @bind-Value="_lobby.Description"
                                               name="host_description" size="64" class="w-100 align-bottom"/>
                                    <input name="submit_description" type="submit" id="submit_description" value="Change"/>
                                </EditForm>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code{
    //private static ILobby _lobby = new Source.LobbySpecificContent.Lobby("Tim's Game", "Just opened", "Tim's Description", 4, false);
    static ILobby _lobby = new Source.LobbySpecificContent.Lobby();
    private string LobbyName { get; set; } = _lobby.Name;
    private string LobbyDescription { get; set; } = "Blaabla";
    // var text = Request["host_description"];

    string GetColorStyle(Color c)
    {
        return "color:" + c.Name;
    }
    
    private string InviteLink { get; set; } = "TicTacTorus.de/lobby/2nd83jf81";
}

@functions{
    static void InitLobby()
    {
        HumanPlayer creator = new HumanPlayer("Eleven", "Caaarl", Color.DodgerBlue, 3);
        _lobby = Source.LobbySpecificContent.LobbyFactory.CreateLobby(creator);
        
        InitPlayerList();
    }
    private static void InitPlayerList()
    {
        _lobby.addPlayer(new HumanPlayer("Tim", "NicerDicer", Color.Coral, 111));
        _lobby.addPlayer(new HumanPlayer("Daniela", "Daisy", Color.Aquamarine, 120));
    }
    //Method that returns a iterator of all lobbies (yield return)   
    static IEnumerable<IPlayer> PlayerList()
    {
        var lobbies = _lobby.GetAllPlayers();
        foreach (var elem in lobbies)
        {
            yield return elem;
        }
    }

    static void HandleDescriptionChange()
    {
        
    }

    static void MessageChatBox(string message)
    {
        
    }
}